@using System.Data.SqlClient
@using System.Net.Sockets

@{
string connString = System.Configuration.ConfigurationManager.ConnectionStrings["Database"].ConnectionString;
var scsb = new SqlConnectionStringBuilder(connString);
string targetHost = scsb.DataSource;
}

<html>
<body>
<h1>DB connection test v2</h1>

<p>
Target host is @targetHost<br/>
Database target is @scsb.InitialCatalog
</p>

<p>
Socket connection:
@{
    try
    {
        using (var tcpClient = new TcpClient())
        {
            tcpClient.Connect(targetHost,1433);
            WriteLiteral("SUCCEEDED");
        }
    }
    catch (SocketException sockEx)
    {
        WriteLiteral(sockEx.Message);
    }
}
</p>

<p>
SQL Connection:
@{
    try
    {
        using (var sqlConn = new SqlConnection(connString))
        {
            using (var sqlCmd = new SqlCommand("SELECT @@Version", sqlConn))
            {
                sqlConn.Open();
                using (var dataReader= sqlCmd.ExecuteReader())
                {
                    if (dataReader.Read())
                    {
                        WriteLiteral( dataReader.GetString(0) );
                    }
                }
            }
        }//using
    }
    catch (SqlException sqlEx)
    {
        WriteLiteral(sqlEx.Message);
    }
}
</p>

</body>
</html>